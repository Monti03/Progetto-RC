<html>
    <script>
        var ws = new WebSocket('ws://localhost:40510'); //per quando lavoro con docker -> localhost:8080 = nginx, /ws/ viene reindirizzato al server sulla porta per creare un ws diretto
        // event emmited when connected
        ws.onopen = function () {
            console.log('websocket is connected ...')
            // sending a send event to websocket server
            //ws.send('connected')
        }
        // event emmited when receiving message 
        ws.onmessage = function (ev) {
            console.log(ev);
            //var d = document.getElementById("input").value
            //document.getElementById("input").value = d +" "+ ev.data 
            addToList(ev.data)
        }

        setInterval(function(){ //mando un messaggio ogni 4 secondi per non far chiudere il ws
            ws.send("")    
        }, 4000);

        function mySend(){
            var nameValue = document.getElementById("from").value;
            document.getElementById("from").value = ""
            ws.send(nameValue)
        }
    </script>
    <style>
        .chat{
            margin-left: 10px;
            margin-top: 5px;
            height: 300px;
            width: 400px;
        }
        
    </style>
    <body>
        <!--<input type="text" class="chat" id="input" disabled="disabled"/>-->
        <div style="overflow-y: scroll; height:200px;">
            <ul id="myList"></ul>
            <script>
                function addToList(msg) {
                    var node = document.createElement("LI");
                    var textnode = document.createTextNode(msg);
                    node.appendChild(textnode);
                    document.getElementById("myList").appendChild(node);
                }
            </script>
        </div>
        <form class="chat" action="JavaScript:mySend();">
            <input type="text" name="from" id="from" value="GIGI">
            <input type="submit" value="Submit">
        </form>
    </body>
</html>
<!--
<html>
    <script type="text/javascript" src = "https://cdnjs.cloudfare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"></script>
    <script type="text/javascript">
        // Create a client instance: Broker, Port, Websocket Path, Client ID
        
        client = new Paho.MQTT.Client("broker", Number(1000), "clientId"); //clid -> settato dal server prima di rimandare la pagina -> incrementerà per ogni connessione
 
        // set callback handlers
        client.onConnectionLost = function (responseObject) {
            console.log("Connection Lost: "+responseObject.errorMessage);
        }
 
        client.onMessageArrived = function (message) {
            console.log("Message Arrived: "+message.payloadString);
        }   
 
        // Called when the connection is made
        function onConnect(){
            client.subscribe("topic");
            console.log("Connected!");
        }
         
        // Connect the client, providing an onConnect callback
        client.connect({
            onSuccess: onConnect
        });

        function publish(){
            var message = new Paho.MQTT.Message(“Message Payload”);
            message.destinationName = “topic”;
            message.qos = 0;
 
            client.send(message);
        }

    </script>

    <body>
        <form action="JavaScript:mySend();">
            <input type="text" name="from" id="from" value="GIGI">
            <input type="submit" value="Submit">
        </form>
    </body>

</html> -->
